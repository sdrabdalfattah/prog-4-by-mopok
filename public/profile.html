<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="MOPOK.png" type="image/x-icon" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Profile</title>
  <link rel="stylesheet" href="prog_4.css">
</head>
<body style="flex-direction: column;">

<div class="user_header" id="user_header">
  <!-- user status here-->
</div>
<div class="user_posts" id="user_posts">
  <!-- user posts here-->
</div>





<div class="img_review" id="img_review">
  <img id="review_img" src="" alt="">
  <button onclick="hideBox()">
      <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" fill="white" width="20" height="20" viewBox="0 0 30 30">
          <path d="M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"></path>
      </svg>
  </button>
</div>



<div class="comments_pop_up" id="comments_pop_up">
  <div class="pop_up_header">comments
   <button onclick="hide_comments_Box()">

       <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" fill="white" width="20" height="20" viewBox="0 0 30 30">
           <path d="M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"></path>
       </svg>

   </button>
  </div>
  <div class="popup_body">


   <div class="comment_body" id="comment_body">
<!-- comments are here -->
   </div>

  </div>
  <div class="add_comment_container">
   <input type="text" placeholder="add comment . . ." id="comment_input" oninput="auto_stop(this)" autocomplete="off">
       <button class="add_comment_btn" id="add_comment_btn" onclick="add_comment()">
           <svg fill="white" width="30" height="30" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">

               <path d="M227.82129,47.9209,175.26758,234.249A15.86994,15.86994,0,0,1,161.207,245.84961q-.69581.05859-1.38379.05762a15.85235,15.85235,0,0,1-14.41406-9.15235l-36.916-77.93359,53.28223-53.28223a8.00052,8.00052,0,0,0-11.31445-11.31445L97.17871,147.50684l-77.93359-36.916A15.9995,15.9995,0,0,1,21.751,80.73242L208.0791,28.17871A15.99909,15.99909,0,0,1,227.82129,47.9209Z"></path>
             </svg>
       </button>
  </div>
  <h1 id="char_count_comment" style="font-size: 15px;opacity: 0;">40 /60</h1>
</div>









  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>

setTimeout(() => {
  img_review.classList.add("hidden");
  popup_body.classList.add("hidden");

}, 300);



function showNotification(message, isSuccess = true) {
    let notification = document.createElement("div");
    notification.className = `al_mokbir ${isSuccess ? 'success' : 'error'}`;
    notification.innerHTML = `${message} <div class="close-btn"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M5.29289 5.29289C5.68342 4.90237 6.31658 4.90237 6.70711 5.29289L12 10.5858L17.2929 5.29289C17.6834 4.90237 18.3166 4.90237 18.7071 5.29289C19.0976 5.68342 19.0976 6.31658 18.7071 6.70711L13.4142 12L18.7071 17.2929C19.0976 17.6834 19.0976 18.3166 18.7071 18.7071C18.3166 19.0976 17.6834 19.0976 17.2929 18.7071L12 13.4142L6.70711 18.7071C6.31658 19.0976 5.68342 19.0976 5.29289 18.7071C4.90237 18.3166 4.90237 17.6834 5.29289 17.2929L10.5858 12L5.29289 6.70711C4.90237 6.31658 4.90237 5.68342 5.29289 5.29289Z" fill="#ffffff" style=""></path>
  </svg></div>`;
    document.body.appendChild(notification);
    setTimeout(() => {
    notification.classList.add("show");
    }, 10);
    let close_notefecation_button = notification.querySelector(".close-btn")
    close_notefecation_button.addEventListener("click", function () {
    notification.classList.remove("show");
    setTimeout(() => notification.remove(), 500);
    });
    setTimeout(() => {
    notification.classList.remove("show");
    setTimeout(() => notification.remove(), 500);
    }, 4000);
    }


function timeAgo(date) {

    const now = new Date();
    const diffInSeconds = Math.floor((now - new Date(date)) / 1000);
    
    const minutes = Math.floor(diffInSeconds / 60);
    const hours = Math.floor(diffInSeconds / 3600);
    const days = Math.floor(diffInSeconds / 86400);
    const years = Math.floor(days / 365);

    if (minutes < 1) {
        return "Just now";
    } else if (minutes === 1) {
        return "1 minute ago";
    } else if (minutes < 60) {
        return `${minutes} minutes ago`;
    } else if (hours < 24) {
        return `${hours} hours ago`;
    } else if (days < 365) {
        return `${days} days ago`;
    } else {
        return `${years} year${years > 1 ? 's' : ''} ago`;
    }
}


let currentPostId = null;




function get_user() {
    const urlParams = new URLSearchParams(window.location.search);
    const   userId = urlParams.get("userId")


  
  axios.get(`https://prog-4-by-mopok.onrender.com/get-user?userId=${userId}`)
  .then(function (response) {
    let user = response.data.user;
  
    let posts = response.data.posts;

        posts.forEach(post => {
          let userPosts = document.getElementById("user_posts");
            
          const isOwner = post.googleId === localStorage.getItem("googleId");

          userPosts.innerHTML += `

          <div class="post_container_profile">

${isOwner ? `
        <div class="post_edit_container">

        <div onclick="delete_post('${post._id}')" class="delleting_btn"><svg fill="#000000" width="25" height="25" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><title fill="#ffffff" style="">ionicons-v5-k</title><rect x="32" y="48" width="448" height="80" rx="32" ry="32" fill="#ffffff" style=""></rect><path d="M74.45,160a8,8,0,0,0-8,8.83L92.76,421.39a1.5,1.5,0,0,0,0,.22A48,48,0,0,0,140.45,464H371.54a48,48,0,0,0,47.67-42.39l0-.21,26.27-252.57a8,8,0,0,0-8-8.83ZM323.31,340.69a16,16,0,1,1-22.63,22.62L256,318.63l-44.69,44.68a16,16,0,0,1-22.63-22.62L233.37,296l-44.69-44.69a16,16,0,0,1,22.63-22.62L256,273.37l44.68-44.68a16,16,0,0,1,22.63,22.62L278.62,296Z" fill="#ffffff" style=""></path></svg></svg>
            
</div>
</div>
    ` : ''}


     <div class="post_content_profile">
    <h1>${post.post_content}</h1>
    <img onclick="showBox('${post.post_photo}')" id="post_img" src="${post.post_photo}" alt="">
</div>
<div class="post_footer_profile">
    
    <button onclick="get_post_comments('${post._id}')"> 
        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="25" height="25" fill="white" viewBox="0 0 24 24">
            <path d="M 12 2 C 7.0414839 2 3 6.0414839 3 11 C 3 15.958516 7.0414839 20 12 20 L 12 23.091797 L 13.539062 22.105469 C 15.774897 20.671437 19.852053 17.575344 20.798828 12.882812 C 20.928446 12.277558 21 11.64776 21 11 C 21 6.0414839 16.958516 2 12 2 z M 12 4 C 15.877484 4 19 7.1225161 19 11 C 19 11.504182 18.94463 11.995387 18.841797 12.472656 L 18.839844 12.480469 L 18.837891 12.486328 C 18.24375 15.434377 15.971604 17.605199 14 19.138672 L 14 17.798828 L 12.875 17.939453 C 12.574056 17.977071 12.283936 18 12 18 C 8.1225161 18 5 14.877484 5 11 C 5 7.1225161 8.1225161 4 12 4 z"></path>
        </svg>
    comments (${post.commentCount})
    </button>
    <span>${timeAgo(post.createdAt)}</span>
</div>
</div>
            `;
        });


let user_header = document.getElementById('user_header');
user_header.innerHTML = `
<img src="${user.avatar}" alt="">
<div style="flex-direction: column;display: flex;">
<h2>${user.name}</h2>
<h1>${user.email}</h1>
</div>
`


  })
  .catch(function (error) {

  })
}get_user()



function get_post_comments(postId) {
    currentPostId = postId;
    document.body.style.overflow = "hidden";
    let popup_body = document.getElementById('comments_pop_up');
    popup_body.style.display = "flex";


    setTimeout(() => {
        popup_body.classList.remove("hidden");
    }, 10);



    axios.get(`https://prog-4-by-mopok.onrender.com/comments/${postId}`)
    .then(function (response) {
    


        document.getElementById('comment_body').innerHTML = ""
      

        let comments = response.data; 


        if (!comments || comments.length === 0) {
            let comment_body = document.getElementById('comment_body');
            comment_body.innerHTML = `<p style="padding:40px;color: grey;font-size: 20px;text-align: center;">No comments available for this post.</p>`;
            return; 
        }




        

        comments.forEach(comment => {
            let comment_body = document.getElementById('comment_body');
            comment_body.innerHTML += `
          
                    <div class="comment_header">
                        <img src="${comment.user_photo}" alt="user photo">
                        <span>${comment.user_name}</span>
                        <p>${timeAgo(comment.createdAt)}</p>
                    </div>
                    <span style="margin-left: 10px;">${comment.content}</span>
            
            `;
            
        });
    })
    .catch(function (error) {

    });
}



let comment_input = document.getElementById('comment_input')
comment_input.onkeyup = function () {

if (comment_input.value === "") {
    document.getElementById('add_comment_btn').classList.remove('not_clue');
} else {
    document.getElementById('add_comment_btn').classList.add('not_clue');
}

}


function add_comment() {
    const comment_input = document.getElementById('comment_input').value;
    let googleId =localStorage.getItem("googleId");




   
    axios.post("https://prog-4-by-mopok.onrender.com/create-comments",  {
        "content": comment_input,
        "googleId":googleId, 
        "postId": currentPostId

      }, {
        headers: {
            withCredentials: true , 
        }
    })
    .then(response => {
        get_post_comments(currentPostId);
        document.getElementById('comment_input').value = "";
        document.getElementById('add_comment_btn').classList.remove('not_clue');

    })
    .catch(error => {

    });
}



function delete_post(currentPostId) {

    axios.delete(`https://prog-4-by-mopok.onrender.com/delete-post?postId=${currentPostId}&googleId=${localStorage.getItem("googleId")}`)
.then(response => {

    document.getElementById("user_posts").innerHTML = ""
    get_user()
    showNotification("post deleted succsesfully", true)
})
.catch(error => {

    showNotification("unexpected error", false)
});

}





  </script>
  <script src="prog_4.js"></script>
  <script src="axios.js"></script>
</body>
</html>


